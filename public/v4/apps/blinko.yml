captainVersion: 4
services:
    $$cap_appname-postgres:
        image: postgres:$$cap_postgres_version
        volumes:
            - $$cap_appname-postgres-data:/var/lib/postgresql/data
        restart: always
        environment:
            POSTGRES_DB: blinko
            POSTGRES_USER: blinko
            POSTGRES_PASSWORD: $$cap_postgres_password
            TZ: $$cap_timezone
        caproverExtra:
            notExposeAsWebApp: 'true'
    $$cap_appname:
        depends_on:
            - $$cap_appname-postgres
        image: blinkospace/blinko:$$cap_blinko_version
        volumes:
            - $$cap_appname-data:/app/.blinko
        restart: always
        environment:
            NODE_ENV: production
            DATABASE_URL: postgresql://blinko:$$cap_postgres_password@srv-captain--$$cap_appname-postgres:5432/blinko
            NEXTAUTH_SECRET: $$cap_nextauth_secret
            NEXTAUTH_URL: https://$$cap_appname.$$cap_root_domain
        caproverExtra:
            containerHttpPort: '1111'
caproverOneClickApp:
    variables:
        - id: $$cap_blinko_version
          label: Blinko Version
          description: Check available versions at https://hub.docker.com/r/blinkospace/blinko/tags
          defaultValue: latest
          validRegex: /^([^\s^\/])+$/
        - id: $$cap_postgres_version
          label: PostgreSQL Version
          description: PostgreSQL database version
          defaultValue: '15'
          validRegex: /^([^\s^\/])+$/
        - id: $$cap_postgres_password
          label: PostgreSQL Password
          description: Auto-generated secure password for PostgreSQL
          defaultValue: $$cap_gen_random_hex(16)
          validRegex: /^[^\@]{12,}$/
        - id: $$cap_nextauth_secret
          label: NextAuth Secret
          description: Auto-generated secret for session encryption
          defaultValue: $$cap_gen_random_hex(32)
          validRegex: /^[^\@]{26,}$/
        - id: $$cap_timezone
          label: Timezone
          description: Timezone for the database (e.g., America/New_York, Europe/London, Asia/Shanghai)
          defaultValue: 'UTC'
    instructions:
        start: |-
            Blinko - AI-powered note-taking application
            
            This deployment includes:
            â€¢ Blinko web application
            â€¢ PostgreSQL database for data storage
            â€¢ Persistent storage for notes and files
            
            Features:
            â€¢ Quick note capture (Blinko cards)
            â€¢ Rich text notes with markdown support
            â€¢ AI-powered features (configurable after installation)
            â€¢ File attachments and media support
            â€¢ Tags and organization
            â€¢ Search functionality
            â€¢ API access for integrations
        end: |-
            âœ… Blinko has been deployed successfully!
            --------------------------------------------
            
            ðŸŒ Access URL: https://$$cap_appname.$$cap_root_domain
            
            ðŸ” Important - First Login:
            â€¢ Create your account on first access
            â€¢ The first registered user becomes the admin
            â€¢ Enable HTTPS in CapRover (required for production)
            
            ðŸ“¦ Deployed Services:
            â€¢ Blinko Application (port 1111)
            â€¢ PostgreSQL $$cap_postgres_version database
            
            ðŸ’¾ Persistent Storage:
            â€¢ Database data: PostgreSQL volume
            â€¢ Application data: /app/.blinko (notes, files, attachments)
            
            âš™ï¸ Configuration:
            â€¢ Access settings after login to configure:
              - AI providers (OpenAI, Ollama, etc.)
              - Storage options (S3 compatible)
              - Webhooks and integrations
              - API tokens
            
            ðŸ“– Features to Explore:
            â€¢ Quick capture with Blinko cards
            â€¢ Create detailed notes
            â€¢ Upload and attach files
            â€¢ Organize with tags
            â€¢ Use AI features for writing assistance
            â€¢ Access via mobile apps (iOS/Android)
            â€¢ API integration for automation
            
            ðŸ”— Resources:
            â€¢ Documentation: https://docs.blinko.space
            â€¢ GitHub: https://github.com/blinko-space/blinko
            â€¢ Telegram (EN): https://t.me/blinkoEnglish
            â€¢ Telegram (CN): https://t.me/blinkoChinese
            
            ðŸ’¡ Tips:
            â€¢ Configure AI providers in Settings > AI for enhanced features
            â€¢ Set up S3 storage in Settings > Storage for cloud backups
            â€¢ Generate API tokens in Settings > Basic for integrations
            â€¢ Explore the webhook feature for automation
    displayName: Blinko
    isOfficial: false
    description: AI-powered note-taking app for capturing fleeting thoughts. Quick notes, rich text, AI features, file attachments, and API integration.
    documentation: 'See more at: https://docs.blinko.space'
